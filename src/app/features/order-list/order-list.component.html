<div class="filter-container">
  <label for="statusFilter">Filter by Status:</label>
  <select
    id="statusFilter"
    [(ngModel)]="selectedStatus"
    (change)="applyFilter()"
  >
    <option value="">All</option>
    <option value="pending">Pending</option>
    <option value="completed">Completed</option>
    <option value="cancelled">Cancelled</option>
  </select>

  <input
    type="text"
    [(ngModel)]="searchingEmail"
    (input)="applyFilter()"
    placeholder="Search by email"
  />
</div>

<div *ngIf="totalCompletedRevenue > 0" class="info-message">
  <strong>Total Revenue from Completed Orders:</strong> €{{
    totalCompletedRevenue
  }}
</div>

<hr />

<div *ngIf="filteredOrders.length === 0" class="no-orders">
  No orders found.
</div>

<ul class="order-list">
  <li *ngFor="let order of filteredOrders" class="order-item">
    <strong>Order Number:</strong> {{ order.orderNumber }}<br />
    <strong>Status:</strong>
    <span *ngIf="!editStatusMap[order._id]">{{ order.status }}</span>
    <select *ngIf="editStatusMap[order._id]" [(ngModel)]="order.status">
      <option value="pending">Pending</option>
      <option value="completed">Completed</option>
      <option value="cancelled">Cancelled</option>
    </select>
    <br />

    <button
      *ngIf="!editStatusMap[order._id]"
      (click)="editStatusMap[order._id] = true"
    >
      Edit Status
    </button>
    <button *ngIf="editStatusMap[order._id]" (click)="saveOrderStatus(order)">
      Save
    </button>
    <button
      *ngIf="editStatusMap[order._id]"
      (click)="editStatusMap[order._id] = false"
    >
      Cancel
    </button>

    <br /><br />
    <strong>Total Amount:</strong> {{ order.totalAmount }}<br />
    <strong>User Email:</strong> {{ order.user.email }}<br />
    <strong>Created At:</strong> {{ order.user.createdAt }}<br />

    <div *ngIf="order.orderItems?.length">
      <strong>Items:</strong>
      <ul>
        <p *ngFor="let item of order.orderItems">
          {{ item.product?.name }} - quantity: {{ item.quantity }} - €{{
            item.price
          }}
        </p>
      </ul>
    </div>
  </li>
</ul>
